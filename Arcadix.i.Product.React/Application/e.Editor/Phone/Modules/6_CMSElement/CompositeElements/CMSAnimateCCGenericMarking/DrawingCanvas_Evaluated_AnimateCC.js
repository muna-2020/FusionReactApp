(function (cjs, an) {

var p; // shortcut to reference prototypes
var lib={};var ss={};var img={};
lib.ssMetadata = [];


// symbols:
// helper functions:

function mc_symbol_clone() {
	var clone = this._cloneProps(new this.constructor(this.mode, this.startPosition, this.loop));
	clone.gotoAndStop(this.currentFrame);
	clone.paused = this.paused;
	clone.framerate = this.framerate;
	return clone;
}

function getMCSymbolPrototype(symbol, nominalBounds, frameBounds) {
	var prototype = cjs.extend(symbol, cjs.MovieClip);
	prototype.clone = mc_symbol_clone;
	prototype.nominalBounds = nominalBounds;
	prototype.frameBounds = frameBounds;
	return prototype;
	}


(lib.resetBtn = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.f("#228AE6").s().p("Ag0B+QgagLgSgSQgTgTgKgZQgLgZAAgcQAAgbALgZQAKgaATgSQASgSAagLQAZgLAbAAQAaAAAZAKQAYAKAUASIAXgXQAFgGAIADQAGADAAAIIAABQQAAAEgDAEQgEADgEAAIhQAAQgIAAgDgHQgDgHAGgFIAZgZQgbgZgkAAQgSAAgRAIQgQAHgMAMQgNANgHARQgHAQAAASQAAASAHARQAHARANANQAMAMAQAHQARAHASAAQAVAAAUgJQATgJAMgRQAAgBABAAQAAAAABAAQAAgBABAAQABAAABAAQAAAAABAAQAAAAABAAQAAAAABABQABAAAAAAIAZAZQAAAAAAABQAAAAABABQAAAAAAABQAAAAAAABIgBAEQgUAXgbANQgcANgfAAQgbAAgZgLg");

	this.shape_1 = new cjs.Shape();
	this.shape_1.graphics.f().s("#FFFFFF").ss(1,1,1).p("AiUCeIAAk7QAAgCACAAQCSABCTgBQACAAAAADIAAE6QAAACgCAAIkkAAQgDAAAAgCg");
	this.shape_1.setTransform(-0.1,0);

	this.shape_2 = new cjs.Shape();
	this.shape_2.graphics.f("#FEFEFE").s().p("AiRCgQgBAAgBAAQAAAAgBgBQAAAAAAAAQAAgBAAAAIAAk7QAAAAAAgBQAAAAAAAAQABgBAAAAQABAAAAAAQCSABCTgBQAAAAABAAQAAAAABABQAAAAAAABQAAAAAAABIAAE6QAAAAAAABQAAAAAAAAQgBABAAAAQgBAAAAAAg");
	this.shape_2.setTransform(-0.1,0);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.shape_2},{t:this.shape_1},{t:this.shape}]}).wait(1));

}).prototype = getMCSymbolPrototype(lib.resetBtn, new cjs.Rectangle(-16,-17,31.9,34), null);


(lib.eraserHi = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.f("#779EBA").s().p("AgUADIADgFIAmAAQgCAFgIAAg");
	this.shape.setTransform(-9.5,4);

	this.shape_1 = new cjs.Shape();
	this.shape_1.graphics.f("#627F97").s().p("AgSADQgBgDABgBQABgBAAAAQAAAAABAAQAAAAABAAQAAAAABAAIADABQAHgBAMAAIALAAQAAAAAAAAQAAAAAAABQABAAAAAAQAAAAAAABIgBADg");
	this.shape_1.setTransform(-9.9,5.1);

	this.shape_2 = new cjs.Shape();
	this.shape_2.graphics.f("#DF7C45").s().p("AhAA+IBRh0QAEgHAHAAIAlAAQgGADgEAEIhQBzIgBABg");
	this.shape_2.setTransform(-0.6,-8.2);

	this.shape_3 = new cjs.Shape();
	this.shape_3.graphics.f("#566E82").s().p("AgUgHQAAAAAAAAQAAgBABAAQAAAAABAAQAAAAABAAIAeAAIAEABQAAAIAFAHIgiAAIgDABQgGgHABgJg");
	this.shape_3.setTransform(-9.7,6.2);

	this.shape_4 = new cjs.Shape();
	this.shape_4.graphics.f("#C2C2C1").s().p("AAHASQgbgBgSgFQgMgDgFgDQgJgGAJgHQAHgFAKgBQAPgEANAAIAWAeQAEAEAFAAIAkgBIAEABIgCAAIgmABIgOAAg");
	this.shape_4.setTransform(-7.6,12.7);

	this.shape_5 = new cjs.Shape();
	this.shape_5.graphics.f("#85B1D4").s().p("AgiAdIgEgBIAmg2IABgCIAmAAIgnA4IgEABg");
	this.shape_5.setTransform(-7.4,0.9);

	this.shape_6 = new cjs.Shape();
	this.shape_6.graphics.f("#4C6272").s().p("AAAAfIgIgNIgKgOIgCgCIgNgSIgNgTQAAAAAAAAQABgBAAAAQAAAAABAAQAAAAABAAIAhgBIACABIAvBDQABACAHADIgNABIgWAAIgBABQgHAAgEgHg");
	this.shape_6.setTransform(-6.6,10.7);

	this.shape_7 = new cjs.Shape();
	this.shape_7.graphics.f("#6C8EA7").s().p("AAWBTQgGgCgDgEIguhDIgBgBQgFgHAAgJIAAgDIgEgBIgYAAIgJgBQAAgBABgEIAFgBIAcAAQAHAAACgFIAmg4IggAAIgEgBIABgBIAEgBIAdAAIAEABIBGBjIgPAWIgZAkQgFAHgHAAg");
	this.shape_7.setTransform(-4.1,6.1);

	this.shape_8 = new cjs.Shape();
	this.shape_8.graphics.f("#C36532").s().p("AgLBtIhCheIgBgDIAMgQIBGhkQADgFAHgBQAHgBAGAHIAvBEQAFAHAAAJQAAAKgFAHIhSBzIgDgDg");
	this.shape_8.setTransform(4.5,-3.3);

	this.shape_9 = new cjs.Shape();
	this.shape_9.graphics.f().s("#3E4040").ss(1,1,1).p("AiUCeIAAk7QAAgCACAAQCSABCTgBQACAAAAADIAAE6QAAACgCAAIkkAAQgDAAAAgCg");
	this.shape_9.setTransform(-0.1,0);

	this.shape_10 = new cjs.Shape();
	this.shape_10.graphics.f("#FEFEFE").s().p("AiRCgQgBAAgBAAQAAAAAAgBQgBAAAAAAQAAgBAAAAIAAk6QAAgBAAgBQAAAAAAAAQABgBAAAAQABAAAAAAQCSABCTgBQAAAAABAAQAAAAABABQAAAAAAABQAAAAAAABIAAE6QAAAAAAABQAAAAAAAAQgBABAAAAQgBAAAAAAg");
	this.shape_10.setTransform(-0.1,0);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.shape_10},{t:this.shape_9},{t:this.shape_8},{t:this.shape_7},{t:this.shape_6},{t:this.shape_5},{t:this.shape_4},{t:this.shape_3},{t:this.shape_2},{t:this.shape_1},{t:this.shape}]}).wait(1));

}).prototype = getMCSymbolPrototype(lib.eraserHi, new cjs.Rectangle(-16,-17,31.9,34), null);


(lib.eraser = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// Layer 1
	this.shape = new cjs.Shape();
	this.shape.graphics.f("#779EBA").s().p("AgUADIADgFIAmAAQgCAFgIAAg");
	this.shape.setTransform(-9.5,4);

	this.shape_1 = new cjs.Shape();
	this.shape_1.graphics.f("#627F97").s().p("AgSADQgBgDABgBQABgBAAAAQAAAAABAAQAAAAABAAQAAAAABAAIADABQAHgBAMAAIALAAQAAAAAAAAQAAAAAAABQABAAAAAAQAAAAAAABIgBADg");
	this.shape_1.setTransform(-9.9,5.1);

	this.shape_2 = new cjs.Shape();
	this.shape_2.graphics.f("#DF7C45").s().p("AhAA+IBRh0QAEgHAHAAIAlAAQgGADgEAEIhQBzIgBABg");
	this.shape_2.setTransform(-0.6,-8.2);

	this.shape_3 = new cjs.Shape();
	this.shape_3.graphics.f("#566E82").s().p("AgUgHQAAAAAAAAQAAgBABAAQAAAAABAAQAAAAABAAIAeAAIAEABQAAAIAFAHIgiAAIgDABQgGgHABgJg");
	this.shape_3.setTransform(-9.7,6.2);

	this.shape_4 = new cjs.Shape();
	this.shape_4.graphics.f("#C2C2C1").s().p("AAHASQgbgBgSgFQgMgDgFgDQgJgGAJgHQAHgFAKgBQAPgEANAAIAWAeQAEAEAFAAIAkgBIAEABIgCAAIgmABIgOAAg");
	this.shape_4.setTransform(-7.6,12.7);

	this.shape_5 = new cjs.Shape();
	this.shape_5.graphics.f("#85B1D4").s().p("AgiAdIgEgBIAmg2IABgCIAmAAIgnA4IgEABg");
	this.shape_5.setTransform(-7.4,0.9);

	this.shape_6 = new cjs.Shape();
	this.shape_6.graphics.f("#4C6272").s().p("AAAAfIgIgNIgKgOIgCgCIgNgSIgNgTQAAAAAAAAQABgBAAAAQAAAAABAAQAAAAABAAIAhgBIACABIAvBDQABACAHADIgNABIgWAAIgBABQgHAAgEgHg");
	this.shape_6.setTransform(-6.6,10.7);

	this.shape_7 = new cjs.Shape();
	this.shape_7.graphics.f("#6C8EA7").s().p("AAWBTQgGgCgDgEIguhDIgBgBQgFgHAAgJIAAgDIgEgBIgYAAIgJgBQAAgBABgEIAFgBIAcAAQAHAAACgFIAmg4IggAAIgEgBIABgBIAEgBIAdAAIAEABIBGBjIgPAWIgZAkQgFAHgHAAg");
	this.shape_7.setTransform(-4.1,6.1);

	this.shape_8 = new cjs.Shape();
	this.shape_8.graphics.f("#C36532").s().p("AgLBtIhCheIgBgDIAMgQIBGhkQADgFAHgBQAHgBAGAHIAvBEQAFAHAAAJQAAAKgFAHIhSBzIgDgDg");
	this.shape_8.setTransform(4.5,-3.3);

	this.shape_9 = new cjs.Shape();
	this.shape_9.graphics.f().s("#FFFFFF").ss(1,1,1).p("AiUCeIAAk7QAAgCACAAQCSABCTgBQACAAAAADIAAE6QAAACgCAAIkkAAQgDAAAAgCg");
	this.shape_9.setTransform(-0.1,0);

	this.shape_10 = new cjs.Shape();
	this.shape_10.graphics.f("#FEFEFE").s().p("AiRCgQgBAAgBAAQAAAAgBgBQAAAAAAAAQAAgBAAAAIAAk7QAAAAAAgBQAAAAAAAAQABgBAAAAQABAAAAAAQCSABCTgBQAAAAABAAQAAAAABABQAAAAAAABQAAAAAAABIAAE6QAAAAAAABQAAAAAAAAQgBABAAAAQgBAAAAAAg");
	this.shape_10.setTransform(-0.1,0);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.shape_10},{t:this.shape_9},{t:this.shape_8},{t:this.shape_7},{t:this.shape_6},{t:this.shape_5},{t:this.shape_4},{t:this.shape_3},{t:this.shape_2},{t:this.shape_1},{t:this.shape}]}).wait(1));

}).prototype = getMCSymbolPrototype(lib.eraser, new cjs.Rectangle(-16,-17,31.9,34), null);


// stage content:
(lib.DrawingCanvas_Evaluated_AnimateCC = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// timeline functions:
	this.frame_0 = function() {
		this.Arcadix = [];
		
		this.Arcadix["InitialArcadix_Mode"] = "Edit";
		this.Arcadix['InitialArcadix_HasSidebar'] = 'Y';
		this.Arcadix['InitialArcadix_Data'] = {};
		//this.Arcadix["InitialArcadix_Mode"] = "Display";
		// this.Arcadix["ConfigArcadix_Mode_IsHidden"] = "Y";
		
		this.Arcadix["InitialArcadix_StrokeSize"] = 3;
		//this.Arcadix['ResourceArcadix_imageURL'] = "https://system.lernlupe.ch/Intranet/Data/Repo/Image/97/522255_Image_1.jpg";
		// this.Arcadix['ResourceArcadix_imageURL'] = "bg.jpg";
		// this.Arcadix["ConfigArcadix_imageURL_IsType"] = "Image";
		
		this.Arcadix["ResourceArcadix_ColorName"] = "DarkRed";
		
		// this.Arcadix["InitialArcadix_totalHitAreas"] = 4;
		
		// this.Arcadix["ResultArcadix_Result"] = 0;
		this.Arcadix['ResultArcadix_Data'] = [];
		
		this.Arcadix["ResourceArcadix_arrCoordinates"] = '';
		this.Arcadix["ResourceArcadix_arrCoordinates_IsHidden"] = "Y";
		
		var color;
		var arrPointsTemp = [];
		var arrPoints = [];
		var rectCoordinates = [];
		this.Arcadix["ResourceArcadix_rectCoordinates"] = '';
		// OBJECT PLACED =======================
		eraser = new lib.eraser();
		ERASER = new createjs.Container();
		ERASER.x = 30;
		ERASER.y = 80;
		ERASER.cursor = "pointer";
		ERASER.visible = false;
		
		ERASER.addChild(eraser);
		eraserHi = new lib.eraserHi();
		ERASERHI = new createjs.Container();
		ERASERHI.x = 30;
		ERASERHI.y = 80;
		ERASERHI.cursor = "pointer";
		ERASERHI.visible = false;
		ERASERHI.addChild(eraserHi);
		
		resetBtn = new lib.resetBtn();
		resetBtn.x = 30;
		resetBtn.y = 30;
		resetBtn.cursor = "pointer";
		
		
		drawingCanvas1 = new createjs.Shape();
		
		bitmapImg = new Image();
		bitmap = new createjs.Bitmap(bitmapImg);
		bitmap.x = 0;
		bitmap.y = 0;
		
		canvas = document.getElementById("canvas");
		
		stage.addChild(resetBtn, ERASER, ERASERHI, drawingCanvas1);


		this.clearStage = function () {
			debugger
			var containerIndx = stage.children.findIndex(a => a['id'] == 'rectContainerGroup');
			if (containerIndx != -1) {
				stage.children[containerIndx].removeAllChildren();

			}
		}                              
	
		this.GenerateBackground = function () {
			this.clearStage();
            debugger
            if (stage.children[0].Arcadix["InitialArcadix_Data"]['BgImage']) {
                if (!stage.children.find(function (a) { return a['BgImageId'] === stage.children[0].Arcadix["InitialArcadix_Data"]['BgImage']['BgImageId'] })) {
                    bgImage = new Image();
                    bgBitmap = new createjs.Bitmap(bgImage);
                    bgBitmap.x = 0;
                    bgBitmap.y = 0;
                    bgBitmap['BgImageId'] = stage.children[0].Arcadix["InitialArcadix_Data"]['BgImage']['BgImageId'];
                    //bgBitmap.image.src = stage.children[0].Arcadix["ResourceArcadix_imageURL"];
                    bgBitmap.image.src = stage.children[0].Arcadix["InitialArcadix_Data"]['BgImage']['Img'];
                    bgBitmap.visible = false;
                    stage.addChild(bgBitmap);
                    bgImage.onload = handlebgBitmap;

                    function handlebgBitmap(event) {
                        stage.canvas.height = bgBitmap.image.height;
                        document.getElementById("canvas").style.height = bgBitmap.image.height + "px";

                        stage.canvas.width = bgBitmap.image.width;
                        document.getElementById("canvas").style.width = bgBitmap.image.width + "px";
                    }
                    document.getElementById("canvas").style.background = "#fff url(" + stage.children[0].Arcadix["InitialArcadix_Data"]['BgImage']['Img'] + ")";

                    //color = stage.children[0].Arcadix["ResourceArcadix_ColorName"];
                    //stroke = stage.children[0].Arcadix["InitialArcadix_StrokeSize"];
                    //if (stage.children[0].Arcadix["InitialArcadix_Mode"] == "Edit") {
                    //    if (stage.children[0].Arcadix["InitialArcadix_actualpoints"] != "") {
                    //        arrCoordinates = stage.children[0].Arcadix["InitialArcadix_actualpoints"];
                    //    }
                    //}    
                }
				generateRects();
			}
			
            //  if (stage.children[0].Arcadix['InitialArcadix_Data']['Initial'])
            // if (stage.children[0].Arcadix["InitialArcadix_Mode"].toLowerCase() === 'edit') {
            //     GenerateDrawings();
            // }
    
        }
      
		this.LoadInitialize = function (data, mode) {
   
			debugger
			stage.children[0].Arcadix['InitialArcadix_HasSidebar'] = 'Y';
			if (mode == undefined || mode == '') {
				if (!this.Arcadix['InitialArcadix_Mode'] && this.Arcadix['InitialArcadix_Mode'] != '') {
					this.Arcadix['InitialArcadix_Mode'] = 'Edit';
				}
				if (this.Arcadix['InitialArcadix_Data'] == '') {
					this.Arcadix['InitialArcadix_Data'] = {};
				}
				if (this.Arcadix['ResultArcadix_Data'] == '') {
					this.Arcadix['ResultArcadix_Data'] = [];
				}

				if (data) {
					this.Arcadix['InitialArcadix_Data'] = data;
				//	this.updateResult()
				}

				this.GenerateBackground();
				if (window.parent.OnConstructLoadComplete) {
					window.parent.OnConstructLoadComplete();
				}
				if (window.parent.OnAnimationLoadComplete) {
					window.parent.OnAnimationLoadComplete();
				}

			}
			else {

				if (this.Arcadix['InitialArcadix_Data'] == '') {
					this.Arcadix['InitialArcadix_Data'] = {};
				}
				if (this.Arcadix['ResultArcadix_Data'] == '') {
					this.Arcadix['ResultArcadix_Data'] = [];
				}

				if (data) {
					this.Arcadix['InitialArcadix_Data'] = data;
				}

				this.Arcadix['InitialArcadix_Mode'] = mode;

				this.GenerateBackground();
				if (window.parent.OnConstructLoadComplete) {
					window.parent.OnConstructLoadComplete();
				}
				if (window.parent.OnAnimationLoadComplete) {
					window.parent.OnAnimationLoadComplete();
				}

			}
		}
		window.setTimeout(this.LoadInitialize.bind(this), 100);
		
		this.LoadSolution = function () {
			stage.children[0].Arcadix['InitialArcadix_HasSidebar'] = 'Y';
            if (this.Arcadix['InitialArcadix_Data'] == '') {
                this.Arcadix['InitialArcadix_Data'] = {};
            }
            if (this.Arcadix['ResultArcadix_Data'] == '') {
                this.Arcadix['ResultArcadix_Data'] = [];
            }
            //this.GenerateBackground();
            if (stage.children[0].Arcadix['InitialArcadix_Mode'] && stage.children[0].Arcadix['InitialArcadix_Mode'] != '') {
                if (stage.children[0].Arcadix['InitialArcadix_Mode'].toLowerCase() === 'edit' || stage.children[0].Arcadix['InitialArcadix_Mode'].toLowerCase() === 'solution') {
                    this.GenerateBackground();
                }
            }  
		}
		
		this.LoadSolutionExecute = function () {
		
			document.getElementById("canvas").style.background = "#fff url(" + stage.children[0].Arcadix['ResourceArcadix_imageURL'] + ")";
			color = stage.children[0].Arcadix["ResourceArcadix_ColorName"];
			stroke = stage.children[0].Arcadix["InitialArcadix_StrokeSize"];
		
			if (this.Arcadix["InitialArcadix_Mode"] != "Edit") {
				resetBtn.removeAllEventListeners();
			}
		
			var arrPoints = stage.children[0].Arcadix["ResourceArcadix_arrCoordinates"];
		
			for (var intIndex = 0; intIndex < arrPoints.length; intIndex++) {
				var objPoint = arrPoints[intIndex];
				drawingCanvas1.graphics.beginStroke(color).setStrokeStyle(stroke, 'round', 'round').moveTo(objPoint.x, objPoint.y).lineTo(arrPoints[intIndex + 1].x, arrPoints[intIndex + 1].y);
			}
		
			stage.update();
		}
		
		//window.setTimeout(this.LoadSolutionExecute.bind(this), 100);
		
		/*this.GetData = function () {
			return stage.children[0].Arcadix;
		}*/
		//DRAG FUNCTIONALITY 
		/*stage.canvas.addEventListener("touchstart", function (e) {
			OverrideMoveableObject(e, [])
		}, false);
		
		function OverrideMoveableObject(objEvent, arrObject) {
			var touches = objEvent.changedTouches;
			var type = objEvent.type;
			stage.preventSelection = false;
			for (var i = 0, l = touches.length; i < l; i++) {
				var touch = touches[i];
				var id = touch.identifier;
				if (touch.target != stage.canvas) {
					continue;
				}
				if (touch.pageY != null) {
					stage._updatePointerPosition(id, objEvent, touch.pageX, touch.pageY);
				}
				var target = null,
					o = stage._getPointerData(id);
				target = o.target = stage._getObjectsUnderPoint(o.x, o.y, null, true);
				for (var j = 0; j < arrObject.length; j++) {
					if (target != null && target.parent != undefined && (target.parent == arrObject[j])) {
						stage.preventSelection = true;
						break;
					}
				}
			}
		}*/
		
		this.GetData = function () {
			return stage.children[0].Arcadix;
		}
		
		// this.GetUserData = function () {
		// 	console.log('running getuserdata',stage.children[0].Arcadix.ResultArcadix_Data);
		// 	return stage.children[0].Arcadix.ResultArcadix_Data;
		// }
		//////////////////
		
		var index = 0;
		stage.enableDOMEvents(true);
		createjs.Touch.enable(stage);
		createjs.Ticker.setFPS(24);
		stage.addEventListener("stagemousedown", handleMouseDown);
		stage.addEventListener("stagemouseup", handleMouseUp);
		color = stage.children[0].Arcadix["ResourceArcadix_ColorName"];
		stroke = stage.children[0].Arcadix["InitialArcadix_StrokeSize"];
		stage.update();
		
		var checkOffsetX = 0;
		var checkOffsetY = 0;
		function handleMouseDown(event) {
			checkOffsetX = stage.mouseX;
			checkOffsetY = stage.mouseY;
			oldPt = new createjs.Point(stage.mouseX, stage.mouseY);
			oldMidPt = oldPt;
			stage.addEventListener("stagemousemove", handleMouseMove);	
			arrPoints = [];
		}
		
		
		function handleMouseMove(event) {
			if(stage.children[0].Arcadix["InitialArcadix_Mode"] == "Display" ){
			stage.setChildIndex(stage, stage.getNumChildren() - 1);
			
			if(stage.mouseX - checkOffsetX > 5 || stage.mouseY - checkOffsetY > 5){
			
			var midPt = new createjs.Point(oldPt.x + stage.mouseX >> 1, oldPt.y + stage.mouseY >> 1);
		
			drawingCanvas1.graphics.clear().setStrokeStyle(stroke, 'round', 'round').beginStroke(color).moveTo(midPt.x, midPt.y).lineTo(oldPt.x, oldPt.y);;
		
			oldPt.x = stage.mouseX;
			oldPt.y = stage.mouseY;
		
			oldMidPt.x = midPt.x;
			oldMidPt.y = midPt.y;	
			arrPoints.push({
				x: stage.mouseX,
				y: stage.mouseY
			});
			stage.update();
			};
			}
		}
		//kb
		// JEvaluate(user's array, keepItEmpty(e.g. {}) , rectangle's array)
		function JEvaluate(arrUser, objInitialAttributes, arrAnswerAttributes) {
		    var isEvaluated = false;
		    var arrAdminRects = arrAnswerAttributes;
		    var arrUserMarks = arrUser
		    var arrEvaluationResult = [];
		
		    if (arrUserMarks && arrAdminRects) {
		        if (arrUserMarks.length === arrAdminRects.length) {
		            for (var i = 0; i < arrAdminRects.length; i++) {  // looping admin rects for matching mark
		            //    debugger
		                if (isMathFoundForShape(arrAdminRects[i]) === true) {
		                    arrAdminRects[i].match = true;
		                    arrEvaluationResult.push(arrAdminRects[i]);
		                } else {
		                    arrAdminRects[i].match = false;
		                    arrEvaluationResult.push(arrAdminRects[i]);
		                }
		            }
		
		            if (arrEvaluationResult.find(function (a) { return a.match === false; })) {
		                isEvaluated = false;
		                return isEvaluated;
		            } else {
		                isEvaluated = true;
		                return isEvaluated;
		            }
		        }else{
		            isEvaluated = false;
		            return isEvaluated;
		        }
		    } else {
		        isEvaluated = false;
		        return isEvaluated;
		    }
		  
		
		    function isMathFoundForShape(objRect) {
		
		        var matchFound = false;
		        if (objRect) {
		            if (arrUserMarks) {
		                for (var j = 0; j < arrUserMarks.length; j++) {
		                    if (isMarkWithinShape(objRect, arrUserMarks[j])) {
		                        matchFound = true;
		                     //   break;
		                        return matchFound;
		                    }
		                }
		                return matchFound;
		            } else {
		                MathFound = false
		                return MathFound;
		            }
		        } else {
		            MathFound = false
		            MathFound;
		        }
		
		    }
		    function isMarkWithinShape(objRect, arrMark) {
		       // debugger
		        var RLeft = objRect.xMin;
		        var RRight = objRect.xMax;
		        var RTop = objRect.yMin;
		        var RBottom = objRect.yMax;
		        var isWithinShape = false;
		        var outSidePoint = arrMark.find(function (a) {
		            if ((a.x >= RLeft) && (a.x <= RRight) && (a.y >= RTop) && (a.y <= RBottom)) {
		                return false;
		            } else {
		                return true;
		            }
		        });
		        if (outSidePoint) {
		            isWithinShape = false;
		            return isWithinShape;
		        } else {
		            isWithinShape = true;
		            return isWithinShape;
		        }
		    }
		
		
		}
		//kb end
		function handleMouseUp(event) {

			checkOffsetX = 0;
			checkOffsetY = 0;
			if (stage.children[0].Arcadix["InitialArcadix_Mode"] == "Display" && arrPoints.length > 0) {
				arrPointsTemp.push(arrPoints);
				stage.children[0].Arcadix["ResultArcadix_Data"] = arrPointsTemp;
				console.log(stage.children[0].Arcadix["ResultArcadix_Data"]);
			}


			if (stage.children[0].Arcadix["InitialArcadix_Mode"] == "Edit") {
				if (window.parent.parent.JEditorWorkArea_AddToCollection != undefined) {
					window.parent.parent.JEditorWorkArea_AddToCollection();
				}
			}

		//	stage.children[0].Arcadix["ResultArcadix_Result"] = stage.children[0].Arcadix["ResourceArcadix_arrCoordinates"];
			console.log('ResultArcadix_Result', stage.children[0].Arcadix["ResultArcadix_Result"]);

			stage.removeEventListener("stagemousemove", handleMouseMove);

		}

		resetBtn.on("pressup", function () {
	    	/*drawingCanvas1.graphics.clear();                                
			stage.children[0].Arcadix["ResourceArcadix_arrCoordinates"] = [];
			stage.clear();                                                   
			stage.update();*/                                                 
			stage.children[0].Arcadix["InitialArcadix_Mode"] = "Display";
			rectContainerGroup.visible = false;		
			stage.update();
		});
			
		//find initial mouse position relative to rect center
		var rect;
			var rectBorder;
			var cWidth;
			var cHeight;
			var rectContainerGroup = new createjs.Container();
			rectContainerGroup.id = "rectContainerGroup";
			stage.addChild(rectContainerGroup);

		function generateRects() {
			//var rectContainer;			
			if (stage.children[0].Arcadix["InitialArcadix_Mode"] == "Edit" || stage.children[0].Arcadix["InitialArcadix_Mode"] == 'Solution') {

				 var shapeCount = 0;
				// if (stage.children[0].Arcadix && stage.children[0].Arcadix.ResultArcadix_Data) {
				// 	shapeCount = stage.children[0].Arcadix.ResultArcadix_Data.length;
				// }
				// if (stage.children[0].Arcadix && stage.children[0].Arcadix.ResultArcadix_Data) {
				// 	if (stage.children[0].Arcadix.ResultArcadix_Data.length == 0) {
				// 		shapeCount = stage.children[0].Arcadix.InitialArcadix_Data.ShapeCount;
				// 	}
				// }

				if(stage.children[0].Arcadix && stage.children[0].Arcadix.InitialArcadix_Data && stage.children[0].Arcadix.InitialArcadix_Data.ResultArcadix && stage.children[0].Arcadix.InitialArcadix_Data.ResultArcadix.length > 0){
					for (i = 0; i < stage.children[0].Arcadix.InitialArcadix_Data.ResultArcadix.length; i++) {
						var rectObj = stage.children[0].Arcadix.InitialArcadix_Data.ResultArcadix[i];
						var rectContainer = new createjs.Container().set({
							x: rectObj.xMin,
							y: rectObj.yMin
						});
						rectContainer.id = "rectContainer" + i;
						rectContainerGroup.addChild(rectContainer);
						rect = new createjs.Shape;
						rect.graphics.beginFill("rgba(0,0,0,0.25)").r(0, 0, rectObj.scaleX * 50, rectObj.scaleY * 50);
						rect.id = "rect" + i;
						rect.setBounds(0, 0, 50, 50);
					if(stage.children[0].Arcadix.InitialArcadix_Mode == 'Edit'){
						rect.on("mousedown", rectmousedown);
						rect.on("pressmove", rectpressmove);
						rect.on("pressup", rectpressup);
					}
						
	
						//create the border as a seperate object
						rectBorder = new createjs.Shape;
						rectBorder.graphics.setStrokeStyle(5, null, null, null, true).beginStroke("#000").r(0, 0, rectObj.scaleX * 50, rectObj.scaleY * 50);
						rectBorder.id = "rectBorder" + i;
						rectBorder.setBounds(0, 0, rectObj.scaleX * 50, rectObj.scaleY * 50);
						if (stage.children[0].Arcadix.InitialArcadix_Mode == 'Edit') {
							rectBorder.on("pressmove", setScale);
							rectBorder.on("mousedown", rectBordermousedown);
							rectBorder.on("pressup", rectBorderpressup);
						}
						//add both to the container
						rectContainer.addChild(rect);
						rectContainer.addChild(rectBorder);
	
						cWidth = rectContainer.getBounds().width;
						cHeight = rectContainer.getBounds().height;
	
						rectCoordinates.push(rectContainer.x, rectContainer.y);
					}
				}else{
					for (i = 0; i < stage.children[0].Arcadix.InitialArcadix_Data.ShapeCount; i++) {
						var rectContainer = new createjs.Container().set({
							x: 100,
							y: 100
						});
						rectContainer.id = "rectContainer" + i;
						rectContainerGroup.addChild(rectContainer);
						rect = new createjs.Shape;
						rect.graphics.beginFill("rgba(0,0,0,0.25)").r(0, 0, 50, 50);
						rect.id = "rect" + i;
						rect.setBounds(0, 0, 50, 50);
						rect.on("mousedown", rectmousedown);
						rect.on("pressmove", rectpressmove);
						rect.on("pressup", rectpressup);
	
						//create the border as a seperate object
						rectBorder = new createjs.Shape;
						rectBorder.graphics.setStrokeStyle(5, null, null, null, true).beginStroke("#000").r(0, 0, 50, 50);
						rectBorder.id = "rectBorder" + i;
						rectBorder.setBounds(0, 0, 50, 50);
	
						rectBorder.on("pressmove", setScale);
						rectBorder.on("mousedown", rectBordermousedown);
						rectBorder.on("pressup", rectBorderpressup);
	
						//add both to the container
						rectContainer.addChild(rect);
						rectContainer.addChild(rectBorder);
	
						cWidth = rectContainer.getBounds().width;
						cHeight = rectContainer.getBounds().height;
	
						rectCoordinates.push(rectContainer.x, rectContainer.y);
					}
				}
				
				//console.log(rectCoordinates);
			}
		}

		function rectBordermousedown(evt) {
			//initial mouse pos
			this.initial = {
				x: Math.abs(evt.localX),
				y: Math.abs(evt.localY)
			};
		};
		var last_mousex = 0;
		var last_mousey = 0;
		//set the relevant rect axis scale to ratio of mouse pos/initial mouse pos
		function setScale(evt) {
			var local = evt.currentTarget.parent.localToGlobal(0, 0);
			this.offset = {
				x: Math.abs(-(local.x - evt.stageX)),
				y: Math.abs(local.y - evt.stageY)
			};
		
			if (this.initial.x - this.initial.y > 5) {
				//sides
				evt.currentTarget.parent.scaleX = (this.offset.x / this.initial.x);
		
			} else if (this.initial.y - this.initial.x > 5) {
				//top/bottom
				evt.currentTarget.parent.scaleY = this.offset.y / this.initial.y;
			} else {
				//diagonals edge case
				evt.currentTarget.parent.scaleX = this.offset.x / this.initial.x;
				evt.currentTarget.parent.scaleY = this.offset.y / this.initial.y;
			}
			stage.update();
		};
		function rectmousedown(evt) {
			last_mousex = parseInt(evt.stageX);
			last_mousey = parseInt(evt.stageY);
		};
		function rectpressmove(evt) {
			evt.currentTarget.parent.x = evt.stageX;
			evt.currentTarget.parent.y = evt.stageY;
			stage.update();
		};
		function setResult() {
			rectCoordinates = [];
			for (i = 0; i < stage.children[5].children.length; i++) {
				rectCoordinates.push({
					xMin: stage.children[5].children[i].x,
					xMax: (stage.children[5].children[i].x + (50 * (Math.floor(stage.children[5].children[i].scaleX * 100) / 100))),
					yMin: stage.children[5].children[i].y,
					yMax: (stage.children[5].children[i].y + (50 * (Math.floor(stage.children[5].children[i].scaleY * 100) / 100))),
					scaleX: stage.children[5].children[i].scaleX,
					scaleY: stage.children[5].children[i].scaleY, 
				});
			}
			stage.children[0].Arcadix["ResultArcadix_Data"] = rectCoordinates;
			stage.children[0].Arcadix.InitialArcadix_Data['ResultArcadix'] = rectCoordinates;
			console.log(stage.children[0].Arcadix["ResultArcadix_Data"]);
			//console.log(rectCoordinates);                         
		}
		function rectpressup(evt) {
			setResult();
		};
		function rectBorderpressup(evt) {
			//console.log(evt.currentTarget.parent);
			setResult();
		};
		
		createjs.Ticker.on("tick", tick);
		function tick(event) {
			if (stage.children[0].Arcadix["InitialArcadix_Mode"] == "Edit" || stage.children[0].Arcadix["InitialArcadix_Mode"] == "Solution") {
				stage.autoClear = true;
			} else {
				stage.autoClear = false;
				
			}
			stage.update(event);
		}
		
		stage.enableMouseOver();
	}

	// actions tween:
	this.timeline.addTween(cjs.Tween.get(this).call(this.frame_0).wait(1));

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = null;
// library properties:
lib.properties = {
	id: '6A6BEB7DF4B5064AAB559C0A6374F9C1',
	width: 374,
	height: 374,
	fps: 24,
	color: "#FFFFFF",
	opacity: 1.00,
	manifest: [],
	preloads: []
};



// bootstrap callback support:

(lib.Stage = function(canvas) {
	createjs.Stage.call(this, canvas);
}).prototype = p = new createjs.Stage();

p.setAutoPlay = function(autoPlay) {
	this.tickEnabled = autoPlay;
}
p.play = function() { this.tickEnabled = true; this.getChildAt(0).gotoAndPlay(this.getTimelinePosition()) }
p.stop = function(ms) { if(ms) this.seek(ms); this.tickEnabled = false; }
p.seek = function(ms) { this.tickEnabled = true; this.getChildAt(0).gotoAndStop(lib.properties.fps * ms / 1000); }
p.getDuration = function() { return this.getChildAt(0).totalFrames / lib.properties.fps * 1000; }

p.getTimelinePosition = function() { return this.getChildAt(0).currentFrame / lib.properties.fps * 1000; }

an.bootcompsLoaded = an.bootcompsLoaded || [];
if(!an.bootstrapListeners) {
	an.bootstrapListeners=[];
}

an.bootstrapCallback=function(fnCallback) {
	an.bootstrapListeners.push(fnCallback);
	if(an.bootcompsLoaded.length > 0) {
		for(var i=0; i<an.bootcompsLoaded.length; ++i) {
			fnCallback(an.bootcompsLoaded[i]);
		}
	}
};

an.compositions = an.compositions || {};
an.compositions['6A6BEB7DF4B5064AAB559C0A6374F9C1'] = {
	getStage: function() { return exportRoot.getStage(); },
	getLibrary: function() { return lib; },
	getSpriteSheet: function() { return ss; },
	getImages: function() { return img; }
};

an.compositionLoaded = function(id) {
	an.bootcompsLoaded.push(id);
	for(var j=0; j<an.bootstrapListeners.length; j++) {
		an.bootstrapListeners[j](id);
	}
}

an.getComposition = function(id) {
	return an.compositions[id];
}



})(createjs = createjs||{}, AdobeAn = AdobeAn||{});
var createjs, AdobeAn;